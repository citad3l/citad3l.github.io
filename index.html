<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description"
        content="Citadel - The privatized Chromium-based enterprise browser that keeps company data inside your walls." />
    <title>Citadel | The Privatized Enterprise Browser</title>

    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700;800&family=JetBrains+Mono:wght@400&display=swap"
        rel="stylesheet">

    <style>
        /* 
         * =========================================
         *  DESIGN SYSTEM: Ultimate Premium
         * =========================================
         */
        :root {
            /* Deep Space Base */
            --color-bg-base: #020617;
            --color-bg-mesh: radial-gradient(circle at 50% 0%, #172554, transparent 70%);

            --color-text-main: #f8fafc;
            --color-text-muted: #94a3b8;
            --color-text-accent: #38bdf8;

            --color-border: rgba(255, 255, 255, 0.08);
            --color-glass: rgba(2, 6, 23, 0.6);
            --color-glass-strong: rgba(2, 6, 23, 0.9);

            --color-primary: #3b82f6;
            --color-primary-hover: #2563eb;

            --glow-spread: 0px;

            --font-ui: 'Inter', sans-serif;
            --font-head: 'Outfit', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            --header-h: 72px;
            --radius-lg: 16px;
            --radius-full: 999px;
            --sidebar-w: 280px;
        }

        /* Reset */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            background-color: var(--color-bg-base);
            background-image: var(--color-bg-mesh);
            background-attachment: fixed;
            color: var(--color-text-main);
            font-family: var(--font-ui);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout */
        .site-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-h);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            background: var(--color-glass-strong);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--color-border);
            z-index: 1000;
        }

        .logo {
            font-family: var(--font-head);
            font-weight: 800;
            font-size: 1.25rem;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo span {
            color: var(--color-text-accent);
            text-shadow: 0 0 15px rgba(56, 189, 248, 0.5);
        }

        .btn-cta {
            padding: 0.6rem 1.4rem;
            background: var(--color-primary);
            color: white;
            font-weight: 600;
            border-radius: var(--radius-full);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            box-shadow: 0 0 0 transparent;
            position: relative;
            overflow: hidden;
        }

        .btn-cta:hover {
            background: var(--color-primary-hover);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
            transform: translateY(-2px) scale(1.02);
        }

        /* Page Structure */
        .page-wrap {
            padding-top: var(--header-h);
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr;
        }

        @media (min-width: 1024px) {
            .content-grid {
                grid-template-columns: var(--sidebar-w) 1fr;
                gap: 5rem;
                padding: 4rem 2rem;
            }
        }

        /* Sidebar */
        .sticky-nav {
            display: none;
        }

        @media (min-width: 1024px) {
            .sticky-nav {
                display: block;
                position: sticky;
                top: calc(var(--header-h) + 2rem);
                height: calc(100vh - var(--header-h) - 4rem);
                overflow-y: auto;
                padding-right: 1rem;
            }
        }

        .nav-link {
            display: block;
            padding: 0.5rem 0;
            color: var(--color-text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            border-left: 2px solid transparent;
            padding-left: 1rem;
            margin-bottom: 0.25rem;
            transition: all 0.2s;
            opacity: 0.7;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--color-text-accent);
            border-color: var(--color-text-accent);
            opacity: 1;
            padding-left: 1.25rem;
            text-shadow: 0 0 10px rgba(56, 189, 248, 0.3);
        }

        .nav-header {
            font-weight: 700;
            color: white;
            margin: 1.5rem 0 0.5rem;
            font-family: var(--font-head);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.5;
        }

        /* Typography & Effects */
        h1 {
            font-family: var(--font-head);
            font-size: clamp(2.5rem, 5vw, 4.5rem);
            line-height: 1.1;
            margin-bottom: 1.5rem;
            letter-spacing: -0.02em;
        }

        h2 {
            font-family: var(--font-head);
            font-size: clamp(2rem, 3vw, 2.5rem);
            margin-top: 5rem;
            margin-bottom: 1.5rem;
            color: white;
            scroll-margin-top: 8rem;
        }

        h3 {
            font-family: var(--font-head);
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #e2e8f0;
        }

        p {
            color: var(--color-text-muted);
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            max-width: 65ch;
            leading-relaxed: 1.7;
        }

        li {
            color: var(--color-text-muted);
            margin-bottom: 0.5rem;
        }

        /* SCRAMBLE TEXT EFFECT CLASS */
        .scramble-text {
            display: inline-block;
            min-height: 1.2em;
            white-space: pre-wrap;
        }

        /* SPOTLIGHT CARD */
        .clean-card {
            /* Glass Base */
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            /* Fallback */
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;

            /* Spotlight Effect Initials */
            --mouse-x: -100px;
            --mouse-y: -100px;
        }

        /* The spotlight gradient overlay */
        .clean-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(800px circle at var(--mouse-x) var(--mouse-y),
                    rgba(255, 255, 255, 0.07),
                    transparent 40%);
            z-index: 0;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* Border Spotlight using a pseudo-element mask */
        .clean-card::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: var(--radius-lg);
            padding: 1px;
            /* Border check */
            background: radial-gradient(600px circle at var(--mouse-x) var(--mouse-y),
                    rgba(56, 189, 248, 0.6),
                    transparent 40%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .clean-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
        }

        .clean-card:hover::before,
        .clean-card:hover::after {
            opacity: 1;
        }

        /* Content z-index fix */
        .clean-card>* {
            position: relative;
            z-index: 2;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .tag {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 99px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tag.blue {
            background: rgba(56, 189, 248, 0.1);
            color: var(--color-text-accent);
            border-color: rgba(56, 189, 248, 0.3);
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.1);
        }

        /* 3D Canvas */
        #canvas-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            pointer-events: none;
            opacity: 1;
            /* Subtle vignette */
            mask-image: linear-gradient(to right, rgba(0, 0, 0, 1) 40%, rgba(0, 0, 0, 0.1) 100%);
        }
    </style>

    <!-- Three.js + PostProcessing Import Map -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
</head>

<body>

    <div id="canvas-bg" aria-hidden="true"></div>

    <header class="site-header">
        <a href="#" class="logo"><span>üõ°</span> Citadel</a>
        <a href="mailto:citadel@protonmail.com" class="btn-cta">Request Demo</a>
    </header>

    <div class="page-wrap">
        <div class="content-grid">

            <!-- Sticky Nav -->
            <aside class="sticky-nav">
                <div class="nav-header">Overview</div>
                <a href="#intro" class="nav-link">Welcome</a>
                <a href="#why" class="nav-link">Why Citadel</a>

                <div class="nav-header">Core Features</div>
                <a href="#localization" class="nav-link">Data Localization</a>
                <a href="#degoogling" class="nav-link">Hard De-Googling</a>
                <a href="#no-ai" class="nav-link">No AI Training</a>

                <div class="nav-header">Protection</div>
                <a href="#genai" class="nav-link">GenAI Guardrails</a>
                <a href="#filtering" class="nav-link">Content Filtering</a>
                <a href="#dlp" class="nav-link">Last-Mile DLP</a>
                <a href="#zero-trust" class="nav-link">Zero Trust</a>

                <div class="nav-header">Governance</div>
                <a href="#logging" class="nav-link">Forensics & Logs</a>
                <a href="#extensions" class="nav-link">Extension Control</a>

                <div class="nav-header">Rollout</div>
                <a href="#reality" class="nav-link">Capabilities</a>
                <a href="#faq" class="nav-link">FAQ</a>
            </aside>

            <!-- Main Content -->
            <main class="main-article">

                <!-- SECTIONS -->

                <section id="intro" class="scroll-trigger"
                    style="min-height: 80vh; display:flex; flex-direction:column; justify-content:center;">
                    <div>
                        <span class="tag blue">Enterprise Browser</span>
                        <h1 class="scramble-trigger">The privatized browser that keeps company data inside your walls.
                        </h1>
                        <p class="lead" style="font-size:1.25rem; color:#cbd5e1;">
                            Citadel is a security-first, de-Googled Chromium browser built for organizations that need
                            real control, real auditability, and real data boundaries.
                        </p>
                        <div style="margin-top: 2rem; display:flex; gap:1rem;">
                            <a href="mailto:citadel@protonmail.com" class="btn-cta"
                                style="padding: 1rem 2rem; font-size:1rem;">Request a Demo</a>
                        </div>
                    </div>
                </section>

                <section id="why" class="scroll-trigger">
                    <h2 class="scramble-trigger">Why Citadel exists</h2>
                    <p>Most ‚Äúenterprise browser‚Äù stories fall apart at the same two moments:</p>
                    <div class="clean-card">
                        <ul style="margin:0; padding-left:1.5rem;">
                            <li>When security asks, <strong style="color:white">‚ÄúWhere does the data actually
                                    go?‚Äù</strong></li>
                            <li>When employees ask, <strong style="color:white">‚ÄúAre you recording my whole
                                    life?‚Äù</strong></li>
                        </ul>
                    </div>
                </section>

                <section id="localization" class="scroll-trigger">
                    <h2 class="scramble-trigger">What makes Citadel different</h2>
                    <div class="feature-grid">
                        <div class="clean-card">
                            <h3>Full data localization</h3>
                            <p>Telemetry, browsing history, and logs stored <strong>only on customer
                                    infrastructure</strong>.</p>
                        </div>
                        <div class="clean-card" id="degoogling">
                            <h3>Hard De-Googling</h3>
                            <p>No hidden "Safe Browsing" pings. No sync services. Fewer compliance headaches.</p>
                        </div>
                    </div>
                </section>

                <section id="no-ai" class="scroll-trigger">
                    <div class="clean-card"
                        style="border:1px solid var(--color-text-accent); background: rgba(56, 189, 248, 0.05);">
                        <h3 style="color: var(--color-text-accent)">Strict ‚ÄúNo AI training‚Äù guarantee</h3>
                        <p><strong>Your page content and prompts do not leave your tenant used to train external
                                models.</strong></p>
                    </div>
                </section>

                <section id="genai" class="scroll-trigger">
                    <h2 class="scramble-trigger">GenAI Guardrails</h2>
                    <p>Detect and control prompts going into GenAI tools. Block sensitive PII before it reaches the
                        model.</p>
                    <div class="clean-card">
                        <h3>Extension Kill-Switch</h3>
                        <p>Automatic detection and quarantine of risky GenAI extensions that read page content.</p>
                    </div>
                </section>

                <section id="filtering" class="scroll-trigger">
                    <h2 class="scramble-trigger">Content Filtering</h2>
                    <p>Enforce policies where browsing happens. Block NSFW, Gambling, and Malware at the browser layer,
                        not just DNS.</p>
                </section>

                <section id="dlp" class="scroll-trigger">
                    <h2 class="scramble-trigger">Last-Mile DLP</h2>
                    <p>Stop the "Copy/Paste" leak. SaaS-aware rules that allow work apps but block personal email.</p>
                    <div class="clean-card">
                        <h3>Personal Cloud Block</h3>
                        <p>Watermark or block uploads to personal Drive/Dropbox.</p>
                    </div>
                </section>

                <section id="zero-trust" class="scroll-trigger">
                    <h2 class="scramble-trigger">Zero Trust Access</h2>
                    <p><em>‚ÄúFinance apps only from corporate network on compliant laptops.‚Äù</em></p>
                    <p>Verify OS patch level and EDR status before granting access.</p>
                </section>

                <section id="logging" class="scroll-trigger">
                    <h2 class="scramble-trigger">Logging & Forensics</h2>
                    <p>Always-on session logging (URL, Uploads, Blocks) streamed directly to your SIEM/SOAR as JSON.</p>
                </section>

                <section id="extensions" class="scroll-trigger">
                    <h2 class="scramble-trigger">Extension Governance</h2>
                    <p>Managed store only. Runtime sandboxing to limit extension API access.</p>
                </section>

                <section id="reality" class="scroll-trigger">
                    <h2 class="scramble-trigger">The Reality Check</h2>
                    <p>Citadel is powerful, but not magic. We can't stop a phone camera. But we raise the cost of bypass
                        significantly.</p>
                </section>

                <section id="faq" class="scroll-trigger">
                    <h2 class="scramble-trigger">FAQ</h2>
                    <div class="clean-card">
                        <p><strong>Is this just Chrome?</strong> No, it's a hardened, de-Googled build.</p>
                        <p><strong>Does it phone home?</strong> No, full localization.</p>
                    </div>
                    <div style="margin-top:5rem; margin-bottom: 5rem; text-align:center;">
                        <h2>Get Started</h2>
                        <a href="mailto:citadel@protonmail.com" class="btn-cta"
                            style="padding:1rem 2.5rem; font-size:1.1rem;">Contact Sales</a>
                        <p style="margin-top:1rem; font-family:var(--font-mono);">citadel@protonmail.com</p>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <!-- 
     * =========================================
     *  SCRIPTS: Ultimate Polish
     *  (Bloom, Spotlight, Scramble, 3D Morph)
     * =========================================
     -->

    <!-- 1. Spotlight UI -->
    <script>
        document.addEventListener('mousemove', (e) => {
            const cards = document.querySelectorAll('.clean-card');
            cards.forEach(card => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                card.style.setProperty('--mouse-x', `${x}px`);
                card.style.setProperty('--mouse-y', `${y}px`);
            });
        });
    </script>

    <!-- 2. Cyber Scramble Text -->
    <script>
        class TextScramble {
            constructor(el) {
                this.el = el;
                this.chars = '!<>-_\\/[]{}‚Äî=+*^?#________';
                this.update = this.update.bind(this);
            }
            setText(newText) {
                const oldText = this.el.innerText;
                const length = Math.max(oldText.length, newText.length);
                const promise = new Promise((resolve) => this.resolve = resolve);
                this.queue = [];
                for (let i = 0; i < length; i++) {
                    const from = oldText[i] || '';
                    const to = newText[i] || '';
                    const start = Math.floor(Math.random() * 40);
                    const end = start + Math.floor(Math.random() * 40);
                    this.queue.push({ from, to, start, end });
                }
                cancelAnimationFrame(this.frameRequest);
                this.frame = 0;
                this.update();
                return promise;
            }
            update() {
                let output = '';
                let complete = 0;
                for (let i = 0, n = this.queue.length; i < n; i++) {
                    let { from, to, start, end, char } = this.queue[i];
                    if (this.frame >= end) {
                        complete++;
                        output += to;
                    } else if (this.frame >= start) {
                        if (!char || Math.random() < 0.28) {
                            char = this.randomChar();
                            this.queue[i].char = char;
                        }
                        output += `<span style="color:var(--color-primary); opacity:0.7;">${char}</span>`;
                    } else {
                        output += from;
                    }
                }
                this.el.innerHTML = output;
                if (complete === this.queue.length) {
                    this.resolve();
                } else {
                    this.frameRequest = requestAnimationFrame(this.update);
                    this.frame++;
                }
            }
            randomChar() {
                return this.chars[Math.floor(Math.random() * this.chars.length)];
            }
        }

        const scrambleObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.classList.contains('scrambled-done')) {
                    const el = entry.target;
                    const text = el.innerText;
                    const fx = new TextScramble(el);
                    fx.setText(text);
                    el.classList.add('scrambled-done');
                }
            });
        }, { threshold: 0.5 });

        document.querySelectorAll('.scramble-trigger').forEach(el => scrambleObserver.observe(el));
    </script>

    <!-- 3. Ultimate 3D Engine -->
    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // Check reduced motion
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (!prefersReducedMotion) initEngine();

        function initEngine() {
            const container = document.getElementById('canvas-bg');
            const scene = new THREE.Scene();
            // Deep fog to blend particles into the void
            scene.fog = new THREE.FogExp2(0x020617, 0.035);

            const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 0, 16);

            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: false, powerPreference: "high-performance" });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5)); // Cap pixel ratio for Bloom perf
            container.appendChild(renderer.domElement);

            // POST-PROCESSING (The "Eye Candy")
            const renderScene = new RenderPass(scene, camera);
            const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.6, 0.5, 0.1);
            // Strength, Radius, Threshold

            const composer = new EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            // ----------------------------------------------------------------
            // PARTICLES
            // ----------------------------------------------------------------
            const count = 4000; // Increased count
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const targets = new Float32Array(count * 3);
            const randoms = new Float32Array(count);
            const sizes = new Float32Array(count);

            for (let i = 0; i < count; i++) {
                // Initial: Big Bang Center
                positions[i * 3] = (Math.random() - 0.5) * 0.5;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 0.5;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 0.5;

                // Targets: defaults
                targets[i * 3] = (Math.random() - 0.5) * 10;
                targets[i * 3 + 1] = (Math.random() - 0.5) * 10;
                targets[i * 3 + 2] = (Math.random() - 0.5) * 10;

                randoms[i] = Math.random();
                sizes[i] = Math.random();
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('aRandom', new THREE.BufferAttribute(randoms, 1));
            geometry.setAttribute('aSize', new THREE.BufferAttribute(sizes, 1));

            const material = new THREE.ShaderMaterial({
                uniforms: {
                    uTime: { value: 0 },
                    uColor: { value: new THREE.Color(0x38bdf8) },
                    uMoodSpeed: { value: 1.0 },
                    uMoodTurbulence: { value: 0.2 },
                },
                vertexShader: `
                    uniform float uTime;
                    uniform float uMoodSpeed;
                    uniform float uMoodTurbulence;
                    attribute float aRandom;
                    attribute float aSize;
                    varying float vAlpha;
                    
                    void main() {
                        vec3 pos = position; 
                        
                        // Noise/Flow
                        float noise = sin(uTime * uMoodSpeed + pos.x) * cos(uTime * uMoodSpeed * 0.8 + pos.y);
                        pos += noise * uMoodTurbulence;
                        
                        // Drift
                        pos.y += sin(uTime * 0.5 + aRandom * 10.0) * 0.1;

                        vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);
                        // Size modulated by Bloom requirements (slightly larger)
                        gl_PointSize = (5.0 * aSize + 2.0) * (20.0 / -mvPosition.z);
                        gl_Position = projectionMatrix * mvPosition;
                        
                        vAlpha = 0.5 + 0.5 * sin(uTime * 2.0 + aRandom * 15.0);
                    }
                `,
                fragmentShader: `
                    uniform vec3 uColor;
                    varying float vAlpha;
                    void main() {
                        // Soft circle
                        float r = distance(gl_PointCoord, vec2(0.5));
                        if(r > 0.5) discard;
                        
                        // Glow core
                        float strength = 1.0 - (r * 2.0);
                        strength = pow(strength, 1.5);

                        gl_FragColor = vec4(uColor, vAlpha * strength);
                    }
                `,
                transparent: true, depthWrite: false, blending: THREE.AdditiveBlending
            });

            const particles = new THREE.Points(geometry, material);
            scene.add(particles);

            // ----------------------------------------------------------------
            // MORPH SHAPES
            // ----------------------------------------------------------------
            const shapes = {
                sphere: (i) => {
                    const r = 6;
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.acos(2 * Math.random() - 1);
                    return { x: r * Math.sin(phi) * Math.cos(theta), y: r * Math.sin(phi) * Math.sin(theta), z: r * Math.cos(phi) };
                },
                box: (i) => {
                    const s = 8;
                    return { x: (Math.random() - 0.5) * s, y: (Math.random() - 0.5) * s, z: (Math.random() - 0.5) * s };
                },
                shield: (i) => {
                    const r = 6;
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.random() * Math.PI * 0.5; // Top half
                    return { x: r * Math.sin(phi) * Math.cos(theta), y: r * Math.sin(phi) * Math.sin(theta), z: r * Math.cos(phi) };
                },
                stream: (i) => {
                    return { x: (Math.random() - 0.5) * 4, y: (Math.random() - 0.5) * 18, z: (Math.random() - 0.5) * 4 };
                },
                ring: (i) => {
                    const r = 5 + Math.random() * 2;
                    const theta = Math.random() * Math.PI * 2;
                    return { x: r * Math.cos(theta), y: (Math.random() - 0.5) * 1, z: r * Math.sin(theta) };
                }
            };

            // Interpolation Vars
            let colorTarget = new THREE.Color(0x38bdf8);
            let speedTarget = 1.0;
            let turbTarget = 0.2;
            let bigBangTriggered = false;

            function updateTarget(shapeName, colorHex, speed, turb) {
                const gen = shapes[shapeName] || shapes.sphere;
                for (let i = 0; i < count; i++) {
                    const p = gen(i);
                    targets[i * 3] = p.x; targets[i * 3 + 1] = p.y; targets[i * 3 + 2] = p.z;
                }
                colorTarget.setHex(colorHex);
                speedTarget = speed;
                turbTarget = turb;
            }

            // Big Bang Init
            updateTarget('sphere', 0x38bdf8, 1.0, 0.2);

            // ----------------------------------------------------------------
            // SCROLL OBSERVER
            // ----------------------------------------------------------------
            const sectionConfigs = {
                'intro': { shape: 'sphere', color: 0x38bdf8, speed: 1.0, turb: 0.2 },
                'why': { shape: 'box', color: 0x818cf8, speed: 1.8, turb: 0.3 },
                'localization': { shape: 'stream', color: 0x38bdf8, speed: 2.2, turb: 0.4 },
                'no-ai': { shape: 'shield', color: 0x34d399, speed: 0.5, turb: 0.15 },
                'genai': { shape: 'sphere', color: 0xf472b6, speed: 3.5, turb: 0.7 },
                'filtering': { shape: 'ring', color: 0xf87171, speed: 2.0, turb: 0.3 },
                'dlp': { shape: 'stream', color: 0xfbbf24, speed: 1.2, turb: 0.1 },
                'zero-trust': { shape: 'shield', color: 0x38bdf8, speed: 0.5, turb: 0.1 },
                'logging': { shape: 'stream', color: 0xc084fc, speed: 1.5, turb: 0.2 },
                'extensions': { shape: 'box', color: 0x94a3b8, speed: 0.5, turb: 0.1 },
                'faq': { shape: 'sphere', color: 0x38bdf8, speed: 1.0, turb: 0.2 }
            };

            const io = new IntersectionObserver((entries) => {
                entries.forEach(e => {
                    if (e.isIntersecting) {
                        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        const navLink = document.querySelector(`.nav-link[href="#${e.target.id}"]`);
                        if (navLink) navLink.classList.add('active');

                        const cfg = sectionConfigs[e.target.id];
                        if (cfg) updateTarget(cfg.shape, cfg.color, cfg.speed, cfg.turb);
                    }
                });
            }, { threshold: 0.25 });
            document.querySelectorAll('.scroll-trigger').forEach(s => io.observe(s));

            // ----------------------------------------------------------------
            // ANIM LOOP
            // ----------------------------------------------------------------
            const clock = new THREE.Clock();

            // Explosive expansion logic
            let bangPhase = 0; // 0=start, 1=explode, 2=settle

            function animate() {
                requestAnimationFrame(animate);
                const dt = clock.getDelta();
                const time = clock.getElapsedTime();

                // Big Bang Sequence
                if (bangPhase === 0 && time > 0.1) bangPhase = 1;

                // Uniform Lerps
                material.uniforms.uTime.value = time;
                material.uniforms.uColor.value.lerp(colorTarget, dt * 1.5);
                material.uniforms.uMoodSpeed.value += (speedTarget - material.uniforms.uMoodSpeed.value) * dt;
                material.uniforms.uMoodTurbulence.value += (turbTarget - material.uniforms.uMoodTurbulence.value) * dt;

                const pos = geometry.attributes.position.array;

                if (bangPhase === 1) {
                    // Explode outward
                    for (let i = 0; i < count; i++) {
                        const ix = i * 3;
                        pos[ix] += (pos[ix] * 10 - pos[ix]) * dt * 5.0; // Rapid expansion
                        pos[ix + 1] += (pos[ix + 1] * 10 - pos[ix + 1]) * dt * 5.0;
                        pos[ix + 2] += (pos[ix + 2] * 10 - pos[ix + 2]) * dt * 5.0;
                    }
                    if (time > 0.5) bangPhase = 2; // Switch to morphing
                } else if (bangPhase === 2) {
                    // Standard Morphing
                    for (let i = 0; i < count; i++) {
                        const ix = i * 3;
                        pos[ix] += (targets[ix] - pos[ix]) * dt * 2.5;
                        pos[ix + 1] += (targets[ix + 1] - pos[ix + 1]) * dt * 2.5;
                        pos[ix + 2] += (targets[ix + 2] - pos[ix + 2]) * dt * 2.5;
                    }
                }

                geometry.attributes.position.needsUpdate = true;

                scene.rotation.y = time * 0.08;

                // Render with Bloom
                composer.render();
            }
            animate();

            // Resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
                composer.setSize(window.innerWidth, window.innerHeight);
            });
        }
    </script>
</body>

</html>
