<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SafeFlow - Luxury Enterprise Security</title>
  <style>
    :root{
      --bg:#050507;
      --text:#f0f0f2;
      --text-muted:#888890;

      /* accents (minimal) */
      --accent:#ff4d4d;
      --accent2:#ff9e9e;

      /* missing vars referenced in original */
      --neon-cyan:#00f3ff;
      --primary-blue:#0b3dff;
      --neon-purple:#8b5cf6;

      --glass:rgba(255,255,255,.04);
      --glass-border:rgba(255,255,255,.08);
      --ease-out:cubic-bezier(.215,.61,.355,1);
      --font-main: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:var(--font-main);
      overflow-x:hidden;
    }

    /* Hide cursor only on fine pointers (desktop) */
    @media (pointer:fine){
      body{cursor:none;}
    }

    /* Ambient background */
    .ambient-bg{
      position:fixed; inset:-25%;
      background:
        radial-gradient(900px 600px at 18% 10%, rgba(139,92,246,.16), transparent 60%),
        radial-gradient(900px 650px at 82% 18%, rgba(0,243,255,.12), transparent 62%),
        radial-gradient(850px 650px at 50% 85%, rgba(255,77,77,.10), transparent 62%),
        linear-gradient(180deg, #060610, #050507);
      filter: blur(18px) saturate(1.15);
      opacity:.8;
      z-index:-2;
      pointer-events:none;
      animation: bgDrift 12s ease-in-out infinite alternate;
      transform: translateZ(0);
    }
    @keyframes bgDrift{
      from{transform:translate3d(-1.5%,-1%,0) scale(1.02)}
      to{transform:translate3d(1.5%,1.2%,0) scale(1.06)}
    }

    /* 1) Scroll progress */
    .progress-container{
      position:fixed; top:0; left:0;
      width:100%; height:3px;
      background:rgba(255,255,255,.05);
      z-index:9999;
    }
    .progress-bar{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, var(--accent), var(--accent2));
    }
    .milestone{
      position:absolute; top:0;
      width:2px; height:6px;
      background:rgba(255,255,255,.2);
      transform:translateY(-2px);
    }

    /* 2) Custom cursor */
    .cursor-dot, .cursor-glow{
      position:fixed;
      top:0; left:0;
      pointer-events:none;
      z-index:10000;
      border-radius:50%;
      transform:translate(-50%,-50%);
      opacity:0; /* enabled via JS only on desktop */
      transition: opacity .2s ease;
    }
    .cursor-dot{
      width:8px; height:8px;
      background:#fff;
      box-shadow:0 0 22px rgba(255,255,255,.22);
    }
    .cursor-glow{
      width:380px; height:380px;
      background:radial-gradient(circle, rgba(255,255,255,.08), transparent 60%);
      opacity:0;
      will-change: transform;
    }

    /* NAV */
    nav{
      position:fixed; top:0; left:0; right:0;
      padding:18px 22px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      z-index:9000;
      backdrop-filter: blur(10px);
      background:linear-gradient(180deg, rgba(5,5,7,.75), rgba(5,5,7,.25));
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .nav-logo{
      font-weight:700;
      letter-spacing:.2px;
    }
    .nav-links{
      display:flex;
      gap:14px;
      align-items:center;
      flex-wrap:wrap;
    }
    .nav-link{
      color:rgba(255,255,255,.74);
      text-decoration:none;
      padding:8px 10px;
      border-radius:12px;
      transition:.2s ease;
    }
    .nav-link:hover{
      color:rgba(255,255,255,.92);
      background:rgba(255,255,255,.05);
    }

    /* 3) Magnetic buttons */
    .btn-magnetic{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:1rem 2rem;
      background:var(--glass);
      border:1px solid var(--glass-border);
      color:var(--text);
      border-radius:999px;
      cursor:pointer;
      text-decoration:none;
      font-weight:550;
      transition: color .25s, background .25s, border-color .25s, transform .15s;
      position:relative;
      overflow:hidden;
      will-change: transform;
    }
    .btn-magnetic:hover{
      background:#fff;
      color:#000;
      border-color:rgba(255,255,255,.45);
    }

    /* Scrollytelling setup */
    .scrolly-container{
      display:grid;
      grid-template-columns: 1fr 1fr;
      min-height: 400vh;
      position:relative;
      padding-top:72px; /* nav space */
    }
    .sticky-col{
      position:sticky;
      top:0;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .scroll-content{
      padding:50vh 0;
    }
    .step{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      justify-content:center;
      padding:0 4rem;
      opacity:.2;
      transition: opacity .5s;
    }
    .step.active{opacity:1}

    /* Stage container (holds WebGL canvas) */
    .stage{
      width:min(620px, 92%);
      aspect-ratio: 1 / 1;
      max-height: 86vh;
      border-radius:28px;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(900px 550px at 20% 15%, rgba(139,92,246,.14), transparent 60%),
        radial-gradient(900px 550px at 85% 20%, rgba(0,243,255,.10), transparent 60%),
        rgba(255,255,255,.02);
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      overflow:hidden;
      position:relative;
      transform-style:preserve-3d;
      perspective:1200px;

      /* driven by JS */
      --tiltX: 0deg;
      --tiltY: 0deg;
      --railY: 0deg;
      --railX: 10deg;
      --railS: 1;
      transform: rotateX(var(--railX)) rotateY(var(--railY)) scale(var(--railS));
      transition: transform .25s var(--ease-out);
    }
    .stage canvas{width:100%; height:100%; display:block}

    /* Masked text reveal */
    .mask-text{
      clip-path: polygon(0 0, 100% 0, 100% 0, 0 0);
      transform: translateY(20px);
      transition: all .8s cubic-bezier(.16,1,.3,1);
      opacity:0;
    }
    .step.active .mask-text{
      clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
      transform: translateY(0);
      opacity:1;
    }
    .mask-text:nth-child(1){transition-delay:.08s}
    .mask-text:nth-child(2){transition-delay:.16s}
    .mask-text:nth-child(3){transition-delay:.24s}

    /* Typography */
    h1,h2{margin:0 0 .8rem; line-height:1.05}
    h1{font-size:clamp(2.1rem, 4vw, 3.2rem)}
    h2{font-size:clamp(1.6rem, 2.4vw, 2.2rem)}
    p{margin:0; line-height:1.55; color:var(--text-muted)}
    .hero-sub{margin-top:.7rem}

    /* Premium Pricing Grid */
    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-top: 3rem;
    }
    .price-card {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      padding: 2.5rem;
      position: relative;
      overflow: hidden;
      transition: transform 0.4s var(--ease-out), border-color 0.3s;
      display: flex;
      flex-direction: column;
    }
    .price-card:hover {
      transform: translateY(-8px);
      border-color: rgba(255,255,255,0.15);
    }
    .price-card.popular {
      background: rgba(255,255,255,0.04);
      border-color: rgba(255,255,255,0.15);
    }
    .popular-badge {
      position: absolute;
      top: 1.5rem; right: 1.5rem;
      background: var(--accent);
      color: #fff;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.3rem 0.8rem;
      border-radius: 99px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .price-amt {
      font-size: 3rem;
      font-weight: 800;
      line-height: 1;
      margin: 1.5rem 0 0.5rem;
      letter-spacing: -0.02em;
    }
    .price-sub {
      color: var(--text-muted);
      font-size: 0.95rem;
      margin-bottom: 2rem;
    }
    
    /* Logo Pills */
    .logo-cloud {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 2rem;
      opacity: 0.6;
    }
    .logo-pill {
      border: 1px solid rgba(255,255,255,0.1);
      padding: 0.6rem 1.2rem;
      border-radius: 99px;
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
    }

    /* Sheen Sweep Effect */
    .sheen-card {
      position: relative;
      overflow: hidden;
    }
    .sheen-card::after {
      content: "";
      position: absolute;
      top: 0; left: -100%;
      width: 50%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
      transform: skewX(-25deg);
      transition: left 0.6s ease;
      pointer-events: none;
    }
    .sheen-card:hover::after {
      left: 150%;
    }

    /* Copy Email Toast */
    .toast-container {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      opacity: 0;
      background: rgba(10, 10, 10, 0.9);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.15);
      padding: 0.8rem 1.5rem;
      border-radius: 99px;
      color: #fff;
      font-weight: 500;
      pointer-events: none;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      z-index: 11000;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    .toast-container.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Footer Chips */
    .footer-chips {
      display: flex;
      gap: 0.8rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }
    .chip-link {
      background: rgba(255,255,255,0.05);
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      text-decoration: none;
      color: var(--text-muted);
      font-size: 0.9rem;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    .chip-link:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
      border-color: rgba(255,255,255,0.1);
    }
    
    footer {
       border-top: 1px solid rgba(255,255,255,0.08);
       padding: 5rem 0;
       margin-top: 10vh;
       background: #020202;
    }
  </style>

  <!-- Three.js import map (kept as in original) -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>
</head>

<body>
  <div class="ambient-bg" aria-hidden="true"></div>

  <!-- Custom Cursor -->
  <div class="cursor-dot" aria-hidden="true"></div>
  <div class="cursor-glow" aria-hidden="true"></div>

  <!-- Scroll Progress -->
  <div class="progress-container" aria-hidden="true">
    <div class="progress-bar" id="progressBar"></div>
    <div class="milestone" style="left: 33%"></div>
    <div class="milestone" style="left: 66%"></div>
  </div>

  <nav>
    <div class="nav-logo">SafeFlow</div>
    <div class="nav-links">
      <a href="#step2" class="nav-link">Product</a>
      <a href="#step3" class="nav-link">Pricing</a>
      <a href="mailto:sales@yourdomain.com?subject=Request%20a%20Demo" class="btn-magnetic" style="margin-left: 10px; padding: 0.8rem 1.5rem;">Request Demo</a>
    </div>
  </nav>

  <!-- Scrollytelling Layout -->
  <div class="scrolly-container">
    <!-- Sticky left: WebGL stage -->
    <div class="sticky-col">
      <div class="stage" id="heroStage" aria-label="3D stage"></div>
    </div>

    <!-- Scrollable right: content -->
    <div class="scroll-content">

      <!-- Step 1 -->
      <section class="step active" id="step1">
        <h1 class="mask-text">Future of<br>Security.</h1>
        <p class="hero-sub mask-text">A corporate-grade security experience built for real teams — fast, calm, and controlled.</p>
        <div style="margin-top:1.4rem;">
          <a class="btn-magnetic" href="mailto:sales@yourdomain.com?subject=Request%20a%20Demo&body=Company%3A%0ATeam%20size%3A%0AUse%20case%3A%0A">Request a Demo</a>
        </div>
      </section>

      <!-- Step 2 -->
      <section class="step" id="step2">
        <h2 class="mask-text">Zero Trust.<br>Zero Friction.</h2>
        <p class="mask-text">Every request verified — without slowing your people down.</p>

        <div class="bento-grid">
          <div class="bento-card large">
            <div class="bento-bg-glow"></div>
            <h3>Intelligent Filtering</h3>
            <p>Real-time detection patterns that help teams stay protected during daily work.</p>
          </div>
          <div class="bento-card">
            <h3>Identity First</h3>
            <p>SSO-ready access control with clear user accountability.</p>
          </div>
          <div class="bento-card">
            <h3>Compliance</h3>
            <p>Reporting designed for audits and leadership reviews.</p>
          </div>
        </div>
      </section>

      <!-- Step 3 -->
      <section class="step" id="step3">
        <h2 class="mask-text">Designed for Scale</h2>
        <p class="mask-text">Simple per-user pricing for teams that need reliability.</p>

        <div class="pricing-box">
          <div class="price-tag mask-text">₹899 <span style="font-size:1rem; font-weight:600; color:var(--text-muted)">/ user / month</span></div>
          <p class="mask-text">Billed annually • Business plan</p>
          <div style="margin-top:1rem;">
            <a class="btn-magnetic" href="mailto:sales@yourdomain.com?subject=Pricing%20Inquiry%20-%20SafeFlow&body=Company%3A%0ATeam%20size%3A%0APlan%20interest%3A%20Business%0A">Ask Pricing</a>
          </div>
        </div>

        <div style="margin-top:2rem; color:var(--text-muted)">
          Single contact: <a href="mailto:sales@yourdomain.com" style="color:rgba(255,255,255,.88); text-decoration:none; border-bottom:1px dashed rgba(255,255,255,.25)">sales@yourdomain.com</a>
        </div>
      </section>
    </div>

      <!-- Step 4: Trusted By (Logo Grid) -->
      <section class="step" id="step4">
        <h2 class="mask-text">Trusted by<br>Security Leaders.</h2>
        <div class="logo-cloud mask-text">
             <div class="logo-pill">Acme Corp</div>
             <div class="logo-pill">GlobalBank</div>
             <div class="logo-pill">Nebula</div>
             <div class="logo-pill">Vertex</div>
             <div class="logo-pill">CyberDyne</div>
             <div class="logo-pill">Massive Dynamic</div>
             <div class="logo-pill">Hooli</div>
             <div class="logo-pill">Stark Ind</div>
        </div>
      </section>

      <!-- Step 5: How It Works -->
      <section class="step" id="step5">
        <h2 class="mask-text">Encryption<br>In Motion.</h2>
        <div class="process-step mask-text">
          <div class="process-num">01</div>
          <div><h3>DNS Resolution</h3><p>Resolved in isolated cloud environments.</p></div>
        </div>
         <div class="process-step mask-text">
          <div class="process-num">02</div>
          <div><h3>Traffic Inspection</h3><p>TLS terminated and inspected for malicious signatures.</p></div>
        </div>
      </section>

      <!-- Step 6: Testimonials (Single Strong) -->
      <section class="step" id="step6">
        <h2 class="mask-text">Impact.</h2>
        <div class="testimonial-card sheen-card mask-text" style="max-width: 500px">
          <p style="font-size: 1.1rem; line-height: 1.6">"SafeFlow stopped a ransomware attack on day one. It pays for itself."</p>
          <div class="user-profile">
             <div class="avatar" style="background: linear-gradient(45deg, #ff4d4d, #f9cb28)"></div>
             <div>
               <div style="font-weight:600">Sarah Connor</div>
               <div style="font-size:0.8rem; color:var(--text-muted)">CISO, TechNoir</div>
             </div>
          </div>
        </div>
      </section>

      <!-- Step 7: Pricing (Three Tier) -->
      <section class="step" id="step7">
        <h2 class="mask-text">Designed for Scale</h2>
        <p class="mask-text">Simple per-user pricing.</p>

        <div class="pricing-grid">
           <!-- Card 1 -->
           <div class="price-card sheen-card mask-text" style="transition-delay: 0.1s">
              <h3 style="margin:0; font-size:1.2rem">Team</h3>
              <div class="price-amt">$12</div>
              <div class="price-sub">/ user / mo</div>
              <ul style="padding-left:1.2rem; color:var(--text-muted); line-height:1.8; margin-bottom:auto">
                <li>SSO Integration</li>
                <li>Threat Filtering</li>
                <li>Email Support</li>
              </ul>
              <a href="mailto:sales@safe.com?subject=Team%20Plan" class="btn-magnetic" style="margin-top:2rem; width:100%">Start Trial</a>
           </div>

           <!-- Card 2 (Popular) -->
           <div class="price-card popular sheen-card mask-text" style="transition-delay: 0.2s">
              <div class="popular-badge">Most Popular</div>
              <h3 style="margin:0; font-size:1.2rem">Business</h3>
              <div class="price-amt">$25</div>
              <div class="price-sub">/ user / mo</div>
              <ul style="padding-left:1.2rem; color:var(--text-muted); line-height:1.8; margin-bottom:auto">
                <li>Everything in Team, plus:</li>
                <li>Audit Logs</li>
                <li>Priority Support</li>
                <li>API Access</li>
              </ul>
              <a href="mailto:sales@safe.com?subject=Business%20Plan" class="btn-magnetic" style="margin-top:2rem; width:100%; background:white; color:black">Get Started</a>
           </div>

           <!-- Card 3 -->
           <div class="price-card sheen-card mask-text" style="transition-delay: 0.3s">
              <h3 style="margin:0; font-size:1.2rem">Enterprise</h3>
              <div class="price-amt">Custom</div>
              <div class="price-sub">Volume pricing</div>
              <ul style="padding-left:1.2rem; color:var(--text-muted); line-height:1.8; margin-bottom:auto">
                <li>On-premise deploy</li>
                <li>Dedicated SAM</li>
                <li>Custom SLA</li>
              </ul>
              <a href="mailto:sales@safe.com?subject=Enterprise%20Plan" class="btn-magnetic" style="margin-top:2rem; width:100%">Contact Sales</a>
           </div>
        </div>
      </section>
    </div>
  </div>

  <footer>
      <div style="max-width: 1200px; margin: 0 auto; padding: 0 2rem;">
          <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 2rem;">
             <div style="max-width: 400px;">
                <div class="nav-logo" style="margin-bottom: 1rem; font-size: 1.5rem;">SafeFlow</div>
                <p style="margin-bottom: 1.5rem;">Secure the future of work with the world's most advanced browser isolation platform.</p>
                <div style="display: flex; gap: 1rem; align-items: center;">
                   <button class="btn-magnetic" id="copyEmailBtn" style="padding: 0.6rem 1.2rem; font-size: 0.9rem;">Copy Email</button>
                   <div class="footer-chips">
                      <a href="mailto:sales@safe.com?subject=Demo" class="chip-link">Request Demo</a>
                      <a href="mailto:sales@safe.com?subject=Pricing" class="chip-link">Get Pricing</a>
                      <a href="mailto:partners@safe.com" class="chip-link">Partner</a>
                   </div>
                </div>
             </div>
             <div>
                <h4 style="margin: 0 0 1rem;">Legal</h4>
                <div style="display:flex; flex-direction:column; gap:0.5rem; color:var(--text-muted);">
                   <a href="#" style="color:inherit; text-decoration:none">Privacy</a>
                   <a href="#" style="color:inherit; text-decoration:none">Terms</a>
                   <a href="#" style="color:inherit; text-decoration:none">Security</a>
                </div>
             </div>
          </div>
          <div style="border-top: 1px solid rgba(255,255,255,0.05); margin-top: 3rem; padding-top: 1.5rem; text-align: center; color: var(--text-muted); font-size: 0.8rem;">
             © 2024 SafeFlow Security Inc.
          </div>
      </div>
  </footer>

  <!-- Toast Notif -->
  <div class="toast-container" id="toast">
     <div style="width: 16px; height: 16px; background: #4ade80; border-radius: 50%;"></div>
     Email copied to clipboard
  </div>

  <script>
    // DOM-safe init for all non-module scripts
    window.addEventListener('DOMContentLoaded', () => {
      // 1) Scroll progress
      const progress = document.getElementById('progressBar');
      function onScroll(){
        const winScroll = document.documentElement.scrollTop || document.body.scrollTop || 0;
        const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrolled = height > 0 ? (winScroll / height) * 100 : 0;
        if (progress) progress.style.width = scrolled + "%";
      }
      window.addEventListener('scroll', onScroll, {passive:true});
      onScroll();

      // 2) Cursor (desktop only)
      const finePointer = window.matchMedia && window.matchMedia('(pointer:fine)').matches;
      const dot = document.querySelector('.cursor-dot');
      const glow = document.querySelector('.cursor-glow');

      let cx = window.innerWidth/2, cy = window.innerHeight/2;
      let gx = cx, gy = cy;

      if (finePointer && dot && glow){
        dot.style.opacity = '1';
        glow.style.opacity = '1';

        window.addEventListener('mousemove', (e) => {
          cx = e.clientX; cy = e.clientY;
        }, {passive:true});

        // lightweight follower loop (avoids starting a new animation on every mousemove)
        function cursorLoop(){
          gx += (cx - gx) * 0.08;
          gy += (cy - gy) * 0.08;

          dot.style.transform = `translate(${cx}px, ${cy}px) translate(-50%, -50%)`;
          glow.style.transform = `translate(${gx}px, ${gy}px) translate(-50%, -50%)`;
          requestAnimationFrame(cursorLoop);
        }
        requestAnimationFrame(cursorLoop);
      } else {
        // ensure default cursor on touch devices
        document.body.style.cursor = 'auto';
      }

      // 3) Magnetic buttons (desktop only)
      if (finePointer){
        document.querySelectorAll('.btn-magnetic').forEach(btn => {
          btn.addEventListener('mousemove', (e) => {
            const rect = btn.getBoundingClientRect();
            const x = e.clientX - rect.left - rect.width / 2;
            const y = e.clientY - rect.top - rect.height / 2;
            btn.style.transform = `translate(${x * 0.22}px, ${y * 0.22}px)`;
          });
          btn.addEventListener('mouseleave', () => {
            btn.style.transform = 'translate(0px, 0px)';
          });
        });
      }

      // 4) Scrollytelling step activation + stage rail transforms
      const stage = document.getElementById('heroStage');
      const steps = document.querySelectorAll('.step');

      function updateActiveStep(){
        const mid = window.innerHeight * 0.5;
        steps.forEach(step => {
          const rect = step.getBoundingClientRect();
          const active = rect.top < mid && rect.bottom > mid;
          step.classList.toggle('active', active);

          if (active && stage){
            const y = window.scrollY || 0;
            if (step.id === 'step1'){
              stage.style.setProperty('--railY', `${y * 0.03}deg`);
              stage.style.setProperty('--railX', `10deg`);
              stage.style.setProperty('--railS', `1`);
            } else if (step.id === 'step2'){
              stage.style.setProperty('--railY', `${y * 0.06}deg`);
              stage.style.setProperty('--railX', `18deg`);
              stage.style.setProperty('--railS', `1.10`);
            } else if (step.id === 'step3'){
              stage.style.setProperty('--railY', `${y * 0.10}deg`);
              stage.style.setProperty('--railX', `6deg`);
              stage.style.setProperty('--railS', `0.96`);
            } else if (step.id === 'step4'){ // Trusted By
              stage.style.setProperty('--railY', `${y * 0.12}deg`);
              stage.style.setProperty('--railX', `0deg`);
              stage.style.setProperty('--railS', `0.85`);
            } else if (step.id === 'step5'){ // Process
              stage.style.setProperty('--railY', `${y * 0.15}deg`);
              stage.style.setProperty('--railX', `25deg`);
              stage.style.setProperty('--railS', `1.05`);
            } else if (step.id === 'step6'){ // Testimonials
               stage.style.setProperty('--railY', `${y * 0.18}deg`);
               stage.style.setProperty('--railX', `-10deg`);
               stage.style.setProperty('--railS', `1`);
            }
          }
        });
      }
      window.addEventListener('scroll', updateActiveStep, {passive:true});
      updateActiveStep();

      // Optional: stage tilt vars (kept subtle)
      if (finePointer && stage){
        window.addEventListener('mousemove', (e) => {
          const x = (e.clientX / window.innerWidth - 0.5) * 10;
          const y = (e.clientY / window.innerHeight - 0.5) * 10;
          stage.style.setProperty('--tiltX', `${-y}deg`);
          stage.style.setProperty('--tiltY', `${x}deg`);
        }, {passive:true});
      }
    });
  </script>

  <!-- Three.js module (fixed: RectAreaLightUniformsLib + safer performance) -->
  <script type="module">
    import * as THREE from 'three';
    import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
    import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
    import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
    import { OutputPass } from 'three/addons/postprocessing/OutputPass.js';
    import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';
    import { RectAreaLightUniformsLib } from 'three/addons/lights/RectAreaLightUniformsLib.js';

    // Custom RGB shift shader (subtle)
    const RGBShiftShader = {
      uniforms: { tDiffuse: { value: null }, amount: { value: 0.002 } },
      vertexShader: `
        varying vec2 vUv;
        void main(){ vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }
      `,
      fragmentShader: `
        uniform sampler2D tDiffuse;
        uniform float amount;
        varying vec2 vUv;
        void main(){
          vec2 offset = amount * vec2(cos(vUv.y * 3.0), sin(vUv.x * 3.0));
          vec4 cr = texture2D(tDiffuse, vUv + offset);
          vec4 cga = texture2D(tDiffuse, vUv);
          vec4 cb = texture2D(tDiffuse, vUv - offset);
          gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);
        }
      `
    };

    const container = document.getElementById('heroStage');
    if (!container){
      console.error("Hero Stage container not found!");
      return;
    }

    // Init RectAreaLight uniforms (missing in original => runtime issues)
    RectAreaLightUniformsLib.init();

    // Scene
    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x050507, 0.02);

    // Camera
    const camera = new THREE.PerspectiveCamera(35, container.clientWidth / container.clientHeight, 0.1, 100);
    camera.position.set(0, 0, 12);

    // Renderer
    const renderer = new THREE.WebGLRenderer({ antialias:false, alpha:true, powerPreference:"high-performance" });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 1.6));
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.0;
    container.appendChild(renderer.domElement);

    // Postprocessing
    const composer = new EffectComposer(renderer);
    composer.addPass(new RenderPass(scene, camera));

    const bloomPass = new UnrealBloomPass(
      new THREE.Vector2(container.clientWidth, container.clientHeight),
      0.8, 0.4, 0.85
    );
    bloomPass.threshold = 0.08;
    bloomPass.strength = 0.55;
    bloomPass.radius = 0.45;
    composer.addPass(bloomPass);

    const rgbPass = new ShaderPass(RGBShiftShader);
    composer.addPass(rgbPass);

    composer.addPass(new OutputPass());

    // Hero geometry (reduced detail vs original 60 to avoid heavy CPU)
    const geometry = new THREE.IcosahedronGeometry(2, 20);

    const material = new THREE.MeshPhysicalMaterial({
      color: 0xffffff,
      roughness: 0.15,
      metalness: 0.2,
      transmission: 0.85,
      thickness: 1.2,
      clearcoat: 1.0,
      clearcoatRoughness: 0.1,
      ior: 1.5
    });

    const heroMesh = new THREE.Mesh(geometry, material);
    scene.add(heroMesh);

    const innerLight = new THREE.PointLight(0xff4d4d, 8, 6);
    heroMesh.add(innerLight);

    // Particles (lighter)
    const particlesGeom = new THREE.BufferGeometry();
    const particleCount = 1200;
    const posArray = new Float32Array(particleCount * 3);

    for(let i=0;i<particleCount;i++){
      posArray[i*3]   = (Math.random() - 0.5) * 30;
      posArray[i*3+1] = (Math.random() - 0.5) * 30;
      posArray[i*3+2] = (Math.random() - 0.5) * 20 - 5;
    }
    particlesGeom.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

    const particlesMat = new THREE.PointsMaterial({
      size: 0.03,
      color: 0x88ccff,
      transparent: true,
      opacity: 0.55,
      blending: THREE.AdditiveBlending,
      depthWrite: false
    });

    const starfield = new THREE.Points(particlesGeom, particlesMat);
    scene.add(starfield);

    // Lights
    const cursorLight = new THREE.PointLight(0xff3333, 90, 30);
    cursorLight.position.set(0,0,8);
    scene.add(cursorLight);

    const rectLight = new THREE.RectAreaLight(0x0077ff, 4, 20, 20);
    rectLight.position.set(-10, 10, 5);
    rectLight.lookAt(0,0,0);
    scene.add(rectLight);

    // Deformation cache
    const positionAttribute = geometry.getAttribute('position');
    const vertex = new THREE.Vector3();
    const originalPositions = new Array(positionAttribute.count);
    for(let i=0;i<positionAttribute.count;i++){
      vertex.fromBufferAttribute(positionAttribute, i);
      originalPositions[i] = vertex.clone();
    }

    // Interaction
    let mouseX = 0, mouseY = 0;
    let targetX = 0, targetY = 0;

    const finePointer = window.matchMedia && window.matchMedia('(pointer:fine)').matches;
    if (finePointer){
      window.addEventListener('mousemove', (e) => {
        mouseX = (e.clientX / window.innerWidth) * 2 - 1;
        mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
      }, {passive:true});
    }

    let scrollY = 0;
    window.addEventListener('scroll', () => { scrollY = window.scrollY || 0; }, {passive:true});

    const clock = new THREE.Clock();
    let frame = 0;

    function animate(){
      requestAnimationFrame(animate);
      const time = clock.getElapsedTime();
      frame++;

      // Deform (cheap “liquid”)
      const amp = Math.min(0.22 + (scrollY * 0.00025), 0.55);
      for(let i=0;i<positionAttribute.count;i++){
        const base = originalPositions[i];
        vertex.copy(base);

        const noise =
          Math.sin(vertex.x * 2.0 + time * 1.25) *
          Math.cos(vertex.y * 1.5 + time * 1.7) *
          Math.sin(vertex.z * 1.8 + time * 0.6);

        vertex.multiplyScalar(1 + noise * amp);
        positionAttribute.setXYZ(i, vertex.x, vertex.y, vertex.z);
      }
      positionAttribute.needsUpdate = true;

      // Normals are expensive: update every 3 frames
      if (frame % 3 === 0) geometry.computeVertexNormals();

      // Mouse follow (smooth)
      targetX += (mouseX - targetX) * 0.05;
      targetY += (mouseY - targetY) * 0.05;

      cursorLight.position.x = targetX * 8;
      cursorLight.position.y = targetY * 8;

      camera.position.x += (targetX * 0.5 - camera.position.x) * 0.02;
      camera.position.y += (targetY * 0.5 - camera.position.y) * 0.02;
      camera.lookAt(0,0,0);

      // Scroll factor (Dynamic based on page length)
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollFactor = docHeight > 0 ? Math.min(scrollY / docHeight, 1) : 0;

      // Rotation / cinematic
      heroMesh.rotation.y = time * 0.18 + scrollFactor * 6.0; // Faster spin for long scroll
      heroMesh.rotation.z = scrollFactor * 2.0;

      // Material mood shift
      if (scrollFactor < 0.20){
        // Step 1: Hero (Glass)
        material.color.setHSL(0.62, 1.0, 0.92);  
        material.metalness = THREE.MathUtils.lerp(material.metalness, 0.2, 0.06);
        material.transmission = THREE.MathUtils.lerp(material.transmission, 0.85, 0.06);
      } else if (scrollFactor < 0.40){
        // Step 2-3: Features/Pricing (Purple/Red)
        material.color.setHSL(0.78, 1.0, 0.82);  
        material.transmission = THREE.MathUtils.lerp(material.transmission, 0.25, 0.05);
        material.metalness = THREE.MathUtils.lerp(material.metalness, 0.35, 0.05);
      } else if (scrollFactor < 0.60){
        // Step 4: Trusted By (Blue Steel)
        material.color.setHSL(0.6, 0.5, 0.5); 
        material.metalness = THREE.MathUtils.lerp(material.metalness, 0.8, 0.05);
        material.transmission = THREE.MathUtils.lerp(material.transmission, 0.1, 0.05);
      } else if (scrollFactor < 0.80){
        // Step 5: Process (Dark Tech)
        material.color.setHSL(0.6, 1.0, 0.1); 
        material.metalness = THREE.MathUtils.lerp(material.metalness, 0.9, 0.05);
        material.roughness = THREE.MathUtils.lerp(material.roughness, 0.4, 0.05);
      } else {
        // Step 6-7: Footer (Gold/Warm)
        material.color.setHSL(0.1, 1.0, 0.6); 
        material.metalness = THREE.MathUtils.lerp(material.metalness, 1.0, 0.05);
        material.transmission = THREE.MathUtils.lerp(material.transmission, 0.0, 0.05);
      }

      // Post FX pulse (very subtle)
      rgbPass.uniforms.amount.value = 0.0015 + scrollFactor * 0.002;

      starfield.rotation.y = time * 0.03;

      composer.render();
    }
    animate();

    // FAQ Accordion Logic
    document.querySelectorAll('.faq-item').forEach(item => {
        item.addEventListener('click', () => {
            item.classList.toggle('open');
        });
    });

    // Resize
    function onResize(){
      const w = container.clientWidth;
      const h = container.clientHeight;
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
      composer.setSize(w, h);
    }
    window.addEventListener('resize', onResize, {passive:true});

    // Pause rendering when tab hidden (perf)
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) clock.stop();
      else clock.start();
    });
  </script>
  
</body>
</html>
